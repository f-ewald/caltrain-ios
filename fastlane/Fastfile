# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:ios)

platform :ios do
  desc "Generate new localized screenshots"
  lane :screenshots do
    capture_screenshots(scheme: "caltrain")

    # Resize screenshots to App Store requirements based on device type
    screenshot_dir = File.expand_path("./fastlane/screenshots")
    Dir.glob("#{screenshot_dir}/**/*.png").each do |file|
      filename = File.basename(file)

      if filename.include?("iPhone")
        # iPhone screenshots: resize to 1284 Ã— 2778 (6.5" display requirement)
        system("sips", "-z", "2778", "1284", file)
        puts "ðŸ“± Resized iPhone screenshot: #{filename} â†’ 1284Ã—2778"
      elsif filename.include?("iPad")
        # iPad screenshots: resize to 2048 Ã— 2732 (12.9" iPad Pro requirement)
        system("sips", "-z", "2732", "2048", file)
        puts "ðŸ“± Resized iPad screenshot: #{filename} â†’ 2048Ã—2732"
      end
    end

    puts "âœ… All screenshots resized to App Store requirements"
  end
end
